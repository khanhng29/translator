<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EN-VI Translator</title>
    <!-- Thêm đường dẫn đến thư viện FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="style.css">


</head>

<body>
    <div>
        <label for="source-lang">Source Language:</label>
        <select id="source-lang" name="source-lang">
            <option value="en">English</option>
            <option value="vi">Vietnamese</option>
        </select>
    </div>
    <div>
        <label for="target-lang">Target Language:</label>
        <select id="target-lang" name="target-lang">
            <option value="vi">Vietnamese</option>
            <option value="en">English</option>
        </select>
    </div>

    <div>
        <!-- Thêm icon mic và loa -->
        <div style="position: relative;">
            <textarea id="input-text" rows="4" cols="50" placeholder="Enter text"></textarea>
            <span style="position: absolute; right: 10px; bottom: 10px;">
                <i id="mic-icon" class="fas fa-microphone"></i> <!-- Biểu tượng mic -->
                <i id="speaker-icon" class="fas fa-volume-up"></i> <!-- Biểu tượng loa -->
            </span>
        </div>
    </div>
    <div>
        <button id="translate-button">Translate</button>
    </div>
    <div>
        <p>Translated Text:</p>
        <div style="border: 1px solid #ccc; padding: 10px;">
            <p id="translated-text"></p> <!-- Hiển thị văn bản dịch ở đây -->
        </div>
    </div>

    <script>
        const sourceLangSelect = document.getElementById("source-lang");
        const targetLangSelect = document.getElementById("target-lang");

        // Xử lý sự kiện khi thay đổi ngôn ngữ nguồn
        sourceLangSelect.addEventListener("change", function () {
            const sourceLang = sourceLangSelect.value;
            // Tự động chuyển đổi ngôn ngữ đích dựa trên ngôn ngữ nguồn
            const autoTargetLang = sourceLang === "en" ? "vi" : "en";
            // Cập nhật ngôn ngữ đích và hiển thị tương ứng
            targetLangSelect.value = autoTargetLang;
            // Cập nhật nội dung navbar của ngôn ngữ đích
            updateTargetLangNavbar(autoTargetLang);
        });

        // Hàm cập nhật nội dung navbar của ngôn ngữ đích
        function updateTargetLangNavbar(autoTargetLang) {
            const targetLangNavbar = document.getElementById("target-lang-navbar");
            if (autoTargetLang === "en") {
                targetLangNavbar.textContent = "English";
            } else {
                targetLangNavbar.textContent = "Vietnamese";
            }
        }

        document.getElementById("translate-button").addEventListener("click", function () {
            const sourceLang = sourceLangSelect.value;
            const targetLang = targetLangSelect.value;
            const inputText = document.getElementById("input-text").value;

            // Send a request to the server to perform translation
            fetch(`/translate?source_lang=${sourceLang}&target_lang=${targetLang}&text=${inputText}`)
                .then(response => response.text())
                .then(translatedText => {
                    document.getElementById("translated-text").textContent = translatedText;
                });
        });

        // Xử lý sự kiện nhấp chuột vào biểu tượng mic
        const micIcon = document.getElementById("mic-icon");
        micIcon.addEventListener("click", function () {
            const sourceLang = sourceLangSelect.value;  // Lấy giá trị source_lang
            // Gửi yêu cầu để thực hiện ghi âm và dự đoán văn bản
            fetch(`/record_and_predict?source_lang=${sourceLang}`)
                .then(response => response.text())
                .then(transcription => {
                    document.getElementById("input-text").value = transcription;
                });
        });

        // Xử lý sự kiện nhấp chuột vào biểu tượng loa
        const speakerIcon = document.getElementById("speaker-icon");
        speakerIcon.addEventListener("click", function () {
            const translatedText = document.getElementById("translated-text").textContent;
            const targetLang = targetLangSelect.value;

            // Nếu ngôn ngữ đích là tiếng Anh, gửi yêu cầu để đọc tiếng Anh bằng giọng nói
            if (targetLang === "en") {
                fetch("/speak_english?text=" + encodeURIComponent(translatedText))
                    .then(response => response.blob())
                    .then(blob => {
                        const audio = new Audio(URL.createObjectURL(blob));
                        audio.play();
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });
            } else {
                // Ngược lại, gửi yêu cầu để đọc văn bản đã dịch bằng giọng nói tiếng Việt
                fetch(`/speak?text=${encodeURIComponent(translatedText)}`)
                    .then(response => response.blob())
                    .then(blob => {
                        const audio = new Audio(URL.createObjectURL(blob));
                        audio.play();
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });
            }
        });



    </script>
</body>

</html>